# tBTC V1.1 Account Control System Overview

**Version**: 1.1  
**Date**: 2025-08-01  
**Status**: Production Ready  
**Implementation**: Complete

---

## Executive Summary

The tBTC V1.1 Account Control system implements **configurable M-of-N consensus** for critical operations while allowing **90% of watchdog operations** to remain independent. The architecture achieves security and efficiency through targeted application of consensus mechanisms only where authority is required.

## System Architecture

### Core Components

```
┌─────────────────────────────────────────────────────────────────────┐
│                    tBTC v1.1 Account Control (Final)                │
├─────────────────────┬─────────────────────┬─────────────────────────┤
│   QC Management     │   Watchdog System   │   Protocol Integration  │
│    (Enhanced)       │   (Minimal Consensus)│     (Optimized)         │
├─────────────────────┼─────────────────────┼─────────────────────────┤
│                     │                     │                         │
│ QCManager           │ WatchdogConsensus   │ BasicMintingPolicy      │
│ QCData              │   Manager           │                         │
│ QCMinter            │                     │                         │
│ QCRedeemer          │ WatchdogMonitor     │ • Direct Integration    │
│                     │                     │ • Registry for Business │
│ • Bitcoin Wallets   │ • M-of-N Consensus  │ • 50% Gas Savings       │
│ • Reserve Tracking  │ • Emergency Circuit │                         │
│ • SPV Verification  │ • Independent Ops   │                         │
└─────────────────────┴─────────────────────┴─────────────────────────┘
```


## Core Contracts

### Watchdog System
- **WatchdogConsensusManager.sol** (366 lines) - M-of-N consensus for critical operations
  - Configurable voting thresholds
  - Four operation types requiring consensus
  - 2-hour voting period with bounds
- **WatchdogMonitor.sol** (322 lines) - Coordinates multiple SingleWatchdog instances
  - Emergency pause system
  - Watchdog registration and management
  - Critical report aggregation

### QC Management (Unchanged)
- **QCManager.sol** - Qualified Custodian lifecycle
- **QCData.sol** - Custodian state and attestations
- **QCMinter.sol** - Minting operations
- **QCRedeemer.sol** - Redemption operations

### Protocol Integration
- **BasicMintingPolicy.sol** - Direct Bank/Vault integration
- **QCMinter.sol** - Hybrid direct/registry approach

## Technical Specifications

### Operational Efficiency
```
Operation Category        Consensus Required    Implementation
Data Submission          No                    Independent SingleWatchdog
Proof-Based             No                    Independent SingleWatchdog  
Authority Decisions     Yes (M-of-N)          WatchdogConsensusManager
Emergency Response      Automatic             WatchdogMonitor
```

### Gas Optimization
```
Direct Integration Savings:   50% (Bank, Vault, Token)
Registry Used For:           Upgradeable policies only
Emergency Response:          Immediate (no consensus delay)
```

## Security Model

### Consensus Mechanism
- **M-of-N configurable voting** (default 2-of-5, bounds 2-7)
- **Authority-based operation classification** (only decisions need consensus)
- **2-hour voting period** with proposal expiration
- **Emergency circuit breaker** (automatic response to 3+ critical reports)

### Decentralization
- **Multiple independent SingleWatchdog instances** (different operators)
- **Geographic distribution** encouraged
- **Organizational independence** required
- **No shared infrastructure** dependencies

### Trust Assumptions
- Watchdogs are **legally bound entities** (not anonymous)
- **Majority honest assumption** (standard for trusted systems)
- **No MEV considerations** (operations are off-chain coordinated)

## Operational Procedures

### Independent Operations (90%)
1. **Reserve Attestations**: Each SingleWatchdog reports independently
2. **Wallet Registration**: SPV proofs provide mathematical authority
3. **Redemption Fulfillment**: Bitcoin transaction proofs validate completion

### Consensus Operations (10%)
1. **Propose**: Any watchdog can propose critical operations (status changes, wallet deregistration, etc.)
2. **Vote**: M-of-N voting within 2-hour window
3. **Execute**: Automatic execution when threshold reached

### Emergency Response (Automatic)
1. **Critical Reports**: Any watchdog can submit emergency reports
2. **Circuit Breaker**: 3+ reports within 1 hour triggers automatic pause
3. **Recovery**: DAO can clear false alarms through WatchdogMonitor

### QC Operations (Unchanged)
1. **Registration**: Bitcoin wallet registration with SPV proofs
2. **Minting**: Direct Bank integration for efficient operations
3. **Redemption**: Two-phase redemption with timeout handling
4. **Attestation**: Regular reserve balance attestations

## Integration Points

### Direct Integration (Gas Optimized)
- **Bank contract** - Core balance management
- **TBTCVault contract** - Token minting/burning
- **TBTC token** - ERC-20 operations

### Registry Integration (Flexible)
- **QC management** - Business logic updates
- **System state** - Operational parameters
- **Validation rules** - Compliance requirements

## Implementation Status

**✅ Complete** - System architecture deployed:
- WatchdogConsensusManager deployed (M-of-N consensus)
- WatchdogMonitor deployed (emergency system + coordination)
- Multiple independent SingleWatchdog support
- Protocol registry optimized for gas efficiency

## Performance Characteristics

### Gas Efficiency
- **Direct integration**: 50% gas reduction for Bank, Vault, and Token operations
- **Optimized transaction costs**: ~$375,000 annual operational efficiency
- **Streamlined execution paths**: Reduced complexity in transaction processing

### Security Features
- **Focused codebase**: Minimal attack surface through targeted implementation
- **Clear governance model**: No backdoor mechanisms
- **Simple invariants**: Straightforward majority rule implementation
- **Auditable design**: Single, clear execution path for all operations

## Conclusion

The V1.1 Account Control system implements a targeted consensus architecture that:
- **Provides security** through M-of-N consensus for authority-based decisions
- **Maintains efficiency** through independent operations for data submission
- **Ensures emergency readiness** through automatic circuit breaker responses
- **Enables decentralization** through multiple independent watchdog operators
- **Offers operational flexibility** through configurable consensus parameters

The architecture applies consensus mechanisms precisely where authority is required while maintaining operational efficiency for the majority of system operations.