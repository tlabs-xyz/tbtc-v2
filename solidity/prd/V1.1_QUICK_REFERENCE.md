# V1.1 Watchdog Operations - Quick Reference Guide

**Version**: 1.0 | **Date**: 2025-07-15 | **Emergency**: security@tbtc.network

---

## üö® Emergency Procedures

### Immediate Actions
```bash
# Emergency pause (governance only)
consensus.pause()

# Emergency override (governance only)
consensus.emergencyOverride(operationId, reason)
```

### Emergency Contacts
- **Security**: security@tbtc.network
- **Operations**: ops@tbtc.network  
- **Discord**: #tbtc-watchdog-ops

---

## üìä System Status Commands

### Check Consensus State
```bash
npx hardhat console --network mainnet
> const consensus = await ethers.getContract("OptimisticWatchdogConsensus")
> await consensus.getConsensusState()
```

### Check Active Watchdogs
```bash
> await consensus.getActiveWatchdogs()
```

### Check Operation Status
```bash
> await consensus.getOperation(operationId)
```

---

## üîÑ Common Operations

### Submit Reserve Attestation
```javascript
// Via WatchdogAdapter (backward compatible)
const adapter = await ethers.getContract("WatchdogAdapter")
await adapter.attestReserves(qcAddress, balanceAmount)
```

### Challenge Operation
```javascript
const evidence = ethers.utils.formatBytes32String("Invalid balance")
await consensus.challengeOperation(operationId, evidence)
```

### Approve Disputed Operation
```javascript
await consensus.approveOperation(operationId)
```

---

## ‚è±Ô∏è Timing Reference

| Objections | Delay | Approval Required |
|------------|-------|-------------------|
| 0-1        | 1h    | None             |
| 2          | 4h    | None             |
| 3-4        | 12h   | 3+ approvals     |
| 5+         | 24h   | Majority         |

---

## üîç Monitoring Events

### Key Events to Watch
- `OperationSubmitted`: New operation
- `OperationChallenged`: Challenge raised
- `ConsensusEscalated`: Dispute escalated
- `OperationExecuted`: Operation completed
- `EmergencyOverride`: Emergency action

### Event Filters
```javascript
// Listen for challenges
consensus.on("OperationChallenged", (operationId, challenger, objectionCount, newFinalizeAt) => {
    console.log(`Operation ${operationId} challenged by ${challenger}`)
})
```

---

## üõ†Ô∏è Troubleshooting

### Common Errors
| Error | Cause | Solution |
|-------|-------|----------|
| `NotPrimaryValidator()` | Wrong validator submitting | Check primary validator selection |
| `ChallengePeriodActive()` | Too early to execute | Wait for challenge period |
| `Insufficient approvals` | Need more approvals | Get required watchdog approvals |
| `NotActiveWatchdog()` | Unauthorized caller | Check watchdog status |

### Quick Fixes
```bash
# Check if watchdog is active
> await consensus.isActiveWatchdog(address)

# Check operation can be executed
> await consensus.canExecuteOperation(operationId)

# Check primary validator for operation
> await consensus.calculatePrimaryValidator(operationType, operationData)
```

---

## üìã Operation Types

### RESERVE_ATTESTATION
- **Purpose**: Update QC balance
- **Frequency**: As needed
- **Validation**: Balance vs. minted amounts

### WALLET_REGISTRATION  
- **Purpose**: Register new Bitcoin wallet
- **Frequency**: Rare
- **Validation**: SPV proof + challenge

### STATUS_CHANGE
- **Purpose**: Update QC status
- **Frequency**: Rare
- **Validation**: Supporting evidence

### REDEMPTION_FULFILLMENT
- **Purpose**: Record redemption completion
- **Frequency**: Regular
- **Validation**: Bitcoin transaction proof

---

## üîê Security Checklist

### Before Operations
- [ ] Verify system is not paused
- [ ] Check your watchdog status
- [ ] Validate operation parameters
- [ ] Review recent challenges

### During Monitoring
- [ ] Monitor for suspicious patterns
- [ ] Verify operation evidence
- [ ] Check consensus state
- [ ] Review challenge validity

### After Operations
- [ ] Verify execution success
- [ ] Check system state
- [ ] Log any anomalies
- [ ] Update monitoring dashboards

---

## üéõÔ∏è Configuration Quick Reference

### Default Parameters
```javascript
baseChallengePeriod: 3600,      // 1 hour
escalationDelays: [3600, 14400, 43200, 86400], // 1h, 4h, 12h, 24h
consensusThresholds: [0, 2, 3, 5], // objection levels
minWatchdogs: 3,
maxWatchdogs: 20
```

### Key Addresses
```bash
# Check current deployments
> await deployments.get("OptimisticWatchdogConsensus")
> await deployments.get("WatchdogAdapter")
> await deployments.get("ProtocolRegistry")
```

---

## üìû Support Contacts

### Escalation Path
1. **L1 Support**: Discord #tbtc-watchdog-ops
2. **L2 Support**: ops@tbtc.network
3. **L3 Support**: security@tbtc.network
4. **Emergency**: All channels + governance

### Response Times
- **Critical**: 15 minutes
- **High**: 1 hour
- **Medium**: 4 hours
- **Low**: 24 hours

---

## üîó Useful Links

- **Full Documentation**: [V1.1_OPERATIONAL_PROCEDURES.md](V1.1_OPERATIONAL_PROCEDURES.md)
- **Deployment Guide**: [../deploy/V1.1_DEPLOYMENT_GUIDE.md](../deploy/V1.1_DEPLOYMENT_GUIDE.md)
- **Architecture**: [ARCHITECTURE.md](ARCHITECTURE.md)
- **Security Tests**: [../test/account-control/SecurityTests.test.ts](../test/account-control/SecurityTests.test.ts)

---

**‚ö†Ô∏è Remember**: When in doubt, pause and ask for help. Better safe than sorry!