# V1.1 Watchdog Quorum Implementation Plan

**Date**: 2025-07-15  
**Branch**: `feat/account-control-v1_1`  
**Purpose**: Implement optimistic N-of-M watchdog quorum system  
**Timeline**: 8-10 weeks

## Version Clarification

- **V1.0**: Single trusted watchdog (current implementation - 95% complete)
- **V1.1**: Optimistic N-of-M watchdog quorum (this plan)
- **V2.0**: Future enhancements (cryptographic PoR, cross-chain, etc.)

## Current Status

We've made the strategic decision to:
1. Keep V1.0 as the single watchdog implementation
2. Develop V1.1 as the watchdog quorum enhancement
3. Work on the `feat/account-control-v1_1` branch

## Implementation Roadmap

### Phase 1: Interface Design (Week 1)
**Status**: ðŸ”´ Not Started

1. **Create Core Interfaces**
   - [ ] `IOptimisticWatchdogConsensus.sol`
   - [ ] `IWatchdogOperation.sol`
   - [ ] `IWatchdogRegistry.sol`

2. **Define Data Structures**
   - [ ] `WatchdogOperation` struct
   - [ ] `ConsensusState` struct
   - [ ] Challenge and escalation types

3. **Event Definitions**
   - [ ] `OperationSubmitted`
   - [ ] `OperationChallenged`
   - [ ] `OperationEscalated`
   - [ ] `OperationExecuted`

### Phase 2: Core Implementation (Weeks 2-3)
**Status**: ðŸ”´ Not Started

1. **OptimisticWatchdogConsensus.sol**
   - [ ] Optimistic submission logic
   - [ ] Challenge mechanism
   - [ ] Escalating delays
   - [ ] Consensus execution

2. **WatchdogAdapter.sol**
   - [ ] Implement SingleWatchdog interface
   - [ ] Route to consensus system
   - [ ] Maintain backward compatibility

3. **Gas Optimization**
   - [ ] Target <100k for attestation
   - [ ] Optimize storage layout
   - [ ] Efficient data structures

### Phase 3: Supporting Contracts (Week 4)
**Status**: ðŸ”´ Not Started

1. **WatchdogRegistry.sol** (optional)
   - [ ] Watchdog management
   - [ ] Performance tracking
   - [ ] Role assignments

2. **Integration Updates**
   - [ ] ProtocolRegistry service keys
   - [ ] Role definitions
   - [ ] Migration helpers

### Phase 4: Testing Implementation (Weeks 5-6)
**Status**: ðŸ”´ Not Started

1. **Unit Tests**
   - [ ] Optimistic submission
   - [ ] Challenge scenarios
   - [ ] Escalation logic
   - [ ] Emergency procedures

2. **Integration Tests**
   - [ ] Backward compatibility
   - [ ] Migration scenarios
   - [ ] Performance benchmarks

3. **Security Tests**
   - [ ] Byzantine scenarios
   - [ ] Attack vectors
   - [ ] Edge cases

### Phase 5: Documentation & Deployment (Weeks 7-8)
**Status**: ðŸ”´ Not Started

1. **Update PRDs**
   - [ ] REQUIREMENTS.md for v1.1
   - [ ] ARCHITECTURE.md for quorum
   - [ ] IMPLEMENTATION.md examples

2. **Deployment Scripts**
   - [ ] v1.1 deployment
   - [ ] Migration from v1.0
   - [ ] Role configuration

3. **Operational Docs**
   - [ ] Watchdog operator guide
   - [ ] Monitoring setup
   - [ ] Emergency procedures

## Key Design Decisions

### Optimistic Execution Model
- Primary validator submits operations optimistically
- 1-hour base challenge period
- Any watchdog can challenge with evidence
- Escalating delays: 1h â†’ 4h â†’ 12h

### Consensus Thresholds
- Start with 3-of-5 configuration
- 2 objections trigger escalation
- 3 objections require full consensus
- Progressive scaling to 5-of-9

### Backward Compatibility
- WatchdogAdapter maintains SingleWatchdog interface
- Zero changes to existing Account Control contracts
- Seamless migration path from v1.0

## Success Criteria

1. **Technical**
   - All v1.0 interfaces maintained
   - Gas targets met (<100k attestation)
   - Comprehensive test coverage
   - Security audit ready

2. **Operational**
   - Clear operator procedures
   - Monitoring infrastructure defined
   - Emergency procedures documented

3. **Migration**
   - Zero-downtime upgrade path
   - Rollback capability
   - State preservation

## Next Immediate Actions

1. **Today**: Begin interface design
2. **This Week**: Complete interface definitions
3. **Next Week**: Start core implementation

## Risk Management

### Technical Risks
- Pattern adaptation complexity â†’ Start with direct copying
- Gas optimization challenges â†’ Early profiling
- Integration issues â†’ Extensive testing

### Timeline Risks
- 8-week estimate aggressive â†’ MVP first, enhance later
- Dependencies on v1.0 fixes â†’ Complete v1.0 first

## Notes

- All work on `feat/account-control-v1_1` branch
- V1.0 fixes should be completed first (1-2 days)
- Regular commits with clear v1.1 references
- Update this document as implementation progresses