
> @keep-network/tbtc-v2@1.9.0-dev test:ac
> USE_EXTERNAL_DEPLOY=true TEST_USE_STUBS_TBTC=true hardhat test test/account-control/**/*.test.ts

No need to generate any newer typings.
Error encountered while fetching public networks
 ·------------------------------------|-------------|---------------·
 |  Contract Name                     ·  Size (KB)  ·  Change (KB)  │
 ·····································|·············|················
 |  AccountControl                    ·     13.723  ·               │
 ·····································|·············|················
 |  Address                           ·      0.086  ·               │
 ·····································|·············|················
 |  AddressUpgradeable                ·      0.086  ·               │
 ·····································|·············|················
 |  Bank                              ·      6.738  ·               │
 ·····································|·············|················
 |  BankStub                          ·      6.791  ·               │
 ·····································|·············|················
 |  BitcoinAddressUtils               ·      0.086  ·               │
 ·····································|·············|················
 |  BitcoinTx                         ·      0.086  ·               │
 ·····································|·············|················
 |  BitcoinTx                         ·      0.086  ·               │
 ·····································|·············|················
 |  Branch                            ·      0.086  ·               │
 ·····································|·············|················
 |  Bridge                            ·     22.390  ·               │
 ·····································|·············|················
 |  BridgeGovernance                  ·     19.736  ·               │
 ·····································|·············|················
 |  BridgeGovernanceParameters        ·     14.639  ·               │
 ·····································|·············|················
 |  BridgeState                       ·      0.086  ·               │
 ·····································|·············|················
 |  BTCDepositorWormhole              ·     11.005  ·               │
 ·····································|·············|················
 |  BTCUtils                          ·      0.217  ·               │
 ·····································|·············|················
 |  BytesLib                          ·      0.086  ·               │
 ·····································|·············|················
 |  BytesLib                          ·      0.086  ·               │
 ·····································|·············|················
 |  Chaosnet                          ·      1.564  ·               │
 ·····································|·············|················
 |  CheckBitcoinSigs                  ·      0.086  ·               │
 ·····································|·············|················
 |  Constants                         ·      0.086  ·               │
 ·····································|·············|················
 |  CountersUpgradeable               ·      0.086  ·               │
 ·····································|·············|················
 |  CrosschainUtils                   ·      0.086  ·               │
 ·····································|·············|················
 |  Deposit                           ·      6.894  ·               │
 ·····································|·············|················
 |  DepositSweep                      ·     12.081  ·               │
 ·····································|·············|················
 |  DonationVault                     ·      2.352  ·               │
 ·····································|·············|················
 |  ECDSA                             ·      0.086  ·               │
 ·····································|·············|················
 |  EcdsaAuthorization                ·      0.086  ·               │
 ·····································|·············|················
 |  EcdsaDkg                          ·      0.135  ·               │
 ·····································|·············|················
 |  EcdsaDkgValidator                 ·      6.282  ·               │
 ·····································|·············|················
 |  EcdsaInactivity                   ·      4.385  ·               │
 ·····································|·············|················
 |  EcdsaLib                          ·      0.086  ·               │
 ·····································|·············|················
 |  EcdsaLibStub                      ·      0.506  ·               │
 ·····································|·············|················
 |  ECDSAUpgradeable                  ·      0.086  ·               │
 ·····································|·············|················
 |  EnumerableSet                     ·      0.086  ·               │
 ·····································|·············|················
 |  ERC1967Proxy                      ·      0.751  ·               │
 ·····································|·············|················
 |  ERC20                             ·      2.382  ·               │
 ·····································|·············|················
 |  ERC20Upgradeable                  ·      2.389  ·               │
 ·····································|·············|················
 |  ERC20WithPermit                   ·      5.425  ·               │
 ·····································|·············|················
 |  ERC721                            ·      5.008  ·               │
 ·····································|·············|················
 |  Fraud                             ·      8.775  ·               │
 ·····································|·············|················
 |  GovernanceUtils                   ·      0.086  ·               │
 ·····································|·············|················
 |  Heartbeat                         ·      0.086  ·               │
 ·····································|·············|················
 |  HeartbeatStub                     ·      0.435  ·               │
 ·····································|·············|················
 |  IBridgeTypes                      ·      0.086  ·               │
 ·····································|·············|················
 |  L1BTCDepositorWormhole            ·     12.632  ·               │
 ·····································|·············|················
 |  L1BTCRedeemerWormhole             ·      7.852  ·               │
 ·····································|·············|················
 |  L2BTCDepositorWormhole            ·      4.239  ·               │
 ·····································|·············|················
 |  L2BTCRedeemerWormhole             ·      5.804  ·               │
 ·····································|·············|················
 |  L2TBTC                            ·     11.232  ·               │
 ·····································|·············|················
 |  L2WormholeGateway                 ·      8.563  ·               │
 ·····································|·············|················
 |  Leaf                              ·      0.086  ·               │
 ·····································|·············|················
 |  LightRelay                        ·      8.336  ·               │
 ·····································|·············|················
 |  LightRelayMaintainerProxy         ·      2.619  ·               │
 ·····································|·············|················
 |  LightRelayStub                    ·      8.618  ·               │
 ·····································|·············|················
 |  MaintainerProxy                   ·      8.813  ·               │
 ·····································|·············|················
 |  MaliciousTBTC                     ·      5.238  ·               │
 ·····································|·············|················
 |  Math                              ·      0.086  ·               │
 ·····································|·············|················
 |  MathUpgradeable                   ·      0.086  ·               │
 ·····································|·············|················
 |  MisfundRecovery                   ·      2.092  ·               │
 ·····································|·············|················
 |  MockAccountControl                ·      5.171  ·               │
 ·····································|·············|················
 |  MockBank                          ·      5.185  ·               │
 ·····································|·············|················
 |  MockBankWithSeparatedOps          ·      4.767  ·               │
 ·····································|·············|················
 |  MockBridge                        ·      5.481  ·               │
 ·····································|·············|················
 |  MockBridgeForStarkNet             ·      3.563  ·               │
 ·····································|·············|················
 |  MockL1BTCRedeemerWormhole         ·      6.935  ·               │
 ·····································|·············|················
 |  MockQCData                        ·      2.066  ·               │
 ·····································|·············|················
 |  MockQCManager                     ·      5.090  ·               │
 ·····································|·············|················
 |  MockQCPauseManager                ·      3.770  ·               │
 ·····································|·············|················
 |  MockQCRedeemer                    ·      1.575  ·               │
 ·····································|·············|················
 |  MockQCWalletManager               ·      2.404  ·               │
 ·····································|·············|················
 |  MockReimbursementPool             ·      0.895  ·               │
 ·····································|·············|················
 |  MockReserve                       ·      4.162  ·               │
 ·····································|·············|················
 |  MockReserveOracle                 ·      0.934  ·               │
 ·····································|·············|················
 |  MockSortitionPool                 ·      1.121  ·               │
 ·····································|·············|················
 |  MockStarkGateBridge               ·      3.384  ·               │
 ·····································|·············|················
 |  MockSystemState                   ·      1.228  ·               │
 ·····································|·············|················
 |  MockT                             ·      1.611  ·               │
 ·····································|·············|················
 |  MockTBTCBridge                    ·      3.426  ·               │
 ·····································|·············|················
 |  MockTBTCBridgeWithSweep           ·      2.994  ·               │
 ·····································|·············|················
 |  MockTBTCToken                     ·      3.216  ·               │
 ·····································|·············|················
 |  MockTBTCVault                     ·      1.042  ·               │
 ·····································|·············|················
 |  MockTBTCVault                     ·      1.529  ·               │
 ·····································|·············|················
 |  MockTokenStaking                  ·      0.735  ·               │
 ·····································|·············|················
 |  MockWalletRegistryGovernance      ·      0.205  ·               │
 ·····································|·············|················
 |  MovingFunds                       ·     20.473  ·               │
 ·····································|·············|················
 |  OutboundTx                        ·      0.086  ·               │
 ·····································|·············|················
 |  Position                          ·      0.086  ·               │
 ·····································|·············|················
 |  ProxyAdmin                        ·      1.881  ·               │
 ·····································|·············|················
 |  QCData                            ·     13.136  ·               │
 ·····································|·············|················
 |  QCManager                         ·     21.452  ·               │
 ·····································|·············|················
 |  QCManagerLib                      ·     10.020  ·               │
 ·····································|·············|················
 |  QCMinter                          ·      6.814  ·               │
 ·····································|·············|················
 |  QCPauseManager                    ·     13.706  ·               │
 ·····································|·············|················
 |  QCRedeemer                        ·     17.683  ·               │
 ·····································|·············|················
 |  QCWalletManager                   ·     11.051  ·               │
 ·····································|·············|················
 |  ReceiveApprovalStub               ·      0.728  ·               │
 ·····································|·············|················
 |  Redemption                        ·     17.708  ·               │
 ·····································|·············|················
 |  RedemptionWatchtower              ·      9.612  ·               │
 ·····································|·············|················
 |  ReimbursementPool                 ·      2.610  ·               │
 ·····································|·············|················
 |  RelayUtils                        ·      0.086  ·               │
 ·····································|·············|················
 |  ReserveOracle                     ·     11.323  ·               │
 ·····································|·············|················
 |  Rewards                           ·      0.155  ·               │
 ·····································|·············|················
 |  RNG                               ·      0.086  ·               │
 ·····································|·············|················
 |  SafeCastUpgradeable               ·      0.086  ·               │
 ·····································|·············|················
 |  SafeERC20                         ·      0.086  ·               │
 ·····································|·············|················
 |  SafeERC20Upgradeable              ·      0.086  ·               │
 ·····································|·············|················
 |  SafeMath                          ·      0.086  ·               │
 ·····································|·············|················
 |  SepoliaLightRelay                 ·      8.405  ·               │
 ·····································|·············|················
 |  SortitionPool                     ·     11.652  ·               │
 ·····································|·············|················
 |  SortitionTree                     ·      1.236  ·               │
 ·····································|·············|················
 |  StarkNetBitcoinDepositor          ·     10.569  ·               │
 ·····································|·············|················
 |  StorageSlot                       ·      0.086  ·               │
 ·····································|·············|················
 |  Strings                           ·      0.086  ·               │
 ·····································|·············|················
 |  StringsUpgradeable                ·      0.086  ·               │
 ·····································|·············|················
 |  SystemState                       ·      9.629  ·               │
 ·····································|·············|················
 |  SystemTestRelay                   ·      1.199  ·               │
 ·····································|·············|················
 |  TBTC                              ·      6.753  ·               │
 ·····································|·············|················
 |  TBTCVault                         ·     14.126  ·               │
 ·····································|·············|················
 |  TestBitcoinAddressUtils           ·      8.464  ·               │
 ·····································|·············|················
 |  TestBitcoinAddressUtilsInternals  ·      8.150  ·               │
 ·····································|·············|················
 |  TestBitcoinTx                     ·      5.550  ·               │
 ·····································|·············|················
 |  TestBTCDepositor                  ·      4.537  ·               │
 ·····································|·············|················
 |  TestBTCRedeemer                   ·      5.133  ·               │
 ·····································|·············|················
 |  TestBTCUtilsHelper                ·      1.607  ·               │
 ·····································|·············|················
 |  TestEcdsaLib                      ·      0.506  ·               │
 ·····································|·············|················
 |  TestEmergencyIntegration          ·      1.744  ·               │
 ·····································|·············|················
 |  TestERC20                         ·      5.567  ·               │
 ·····································|·············|················
 |  TestERC721                        ·      5.612  ·               │
 ·····································|·············|················
 |  TestRelay                         ·      1.355  ·               │
 ·····································|·············|················
 |  Timelock                          ·      8.414  ·               │
 ·····································|·············|················
 |  TimelockController                ·      8.414  ·               │
 ·····································|·············|················
 |  TransparentUpgradeableProxy       ·      2.202  ·               │
 ·····································|·············|················
 |  ValidateSPV                       ·      0.086  ·               │
 ·····································|·············|················
 |  VendingMachine                    ·      5.747  ·               │
 ·····································|·············|················
 |  VendingMachineV2                  ·      3.150  ·               │
 ·····································|·············|················
 |  VendingMachineV3                  ·      3.966  ·               │
 ·····································|·············|················
 |  WalletProposalValidator           ·     15.332  ·               │
 ·····································|·············|················
 |  Wallets                           ·      0.086  ·               │
 ·····································|·············|················
 |  Wallets                           ·      3.998  ·               │
 ·····································|·············|················
 |  WatchdogEnforcer                  ·      9.475  ·               │
 ·····································|·············|················
 |  WormholeTypes                     ·      0.086  ·               │
 ·····································|·············|················
 |  WormholeUtils                     ·      0.086  ·               │
 ·------------------------------------|-------------|---------------·

  Bitcoin Address Handling
    P2PKH Addresses
      Validation
        ✓ should validate P2PKH mainnet address through redemption
        ✓ should reject invalid P2PKH format
      Utilities
        ✓ should decode valid P2PKH mainnet address
        ✓ should decode valid P2PKH testnet address
        ✓ should handle P2PKH script generation correctly
        ✓ should reject invalid P2PKH address
    P2SH Addresses
      Validation
        ✓ should validate P2SH mainnet address
      Utilities
        ✓ should decode valid P2SH mainnet address
        ✓ should decode valid P2SH testnet address
    Bech32 Addresses (P2WPKH/P2WSH)
      P2WPKH Validation
        ✓ should validate P2WPKH address
      P2WPKH Utilities
        ✓ should decode valid P2WPKH address
        ✓ should handle P2WPKH script generation correctly
        ✓ should reject invalid bech32 address
      P2WSH Validation
        ✓ should handle P2WSH addresses (32-byte hashes)
      P2WSH Utilities
        ✓ should decode valid P2WSH address
    Testnet Bech32 Addresses (Comprehensive Coverage)
      Testnet P2WPKH (tb1q) Validation
        ✓ should validate lowercase testnet P2WPKH address

        1) should validate uppercase testnet P2WPKH address

        2) should reject mixed case testnet P2WPKH address
      Testnet P2WPKH Utilities
        ✓ should decode lowercase testnet P2WPKH address
        ✓ should decode uppercase testnet P2WPKH address
        ✓ should produce same hash for case variants
        ✓ should reject mixed case testnet addresses
      Testnet P2WSH (tb1q with 32-byte hash) Validation
        ✓ should validate testnet P2WSH address (32-byte hash)
      Testnet P2WSH Utilities
        ✓ should decode testnet P2WSH address with 32-byte hash
        ✓ should handle uppercase testnet P2WSH address
        ✓ should reject mixed case testnet P2WSH addresses
      Testnet Error Cases
        ✓ should reject invalid testnet prefix
        ✓ should reject testnet address without separator
        ✓ should reject too short testnet address
        ✓ should reject testnet address with invalid checksum
      Mainnet vs Testnet Consistency
        ✓ should produce same script types for equivalent addresses
        ✓ should produce same script types for P2WSH variants

        3) should handle both networks consistently
    Address Derivation
      Valid Public Key Derivation
        ✓ should derive correct address from known public key
        ✓ should derive consistent addresses for same public key
        ✓ should produce valid bech32 format for any valid key
        ✓ should produce decodable addresses
      Invalid Public Key Handling
        ✓ should reject public key that is too short
        ✓ should reject public key that is too long
        ✓ should reject public key with wrong length
        ✓ should reject empty public key
      Cross-Implementation Validation
        ✓ should match wallet-signature-helpers implementation
    Error Handling
      Integration Error Cases
        ✓ should reject empty Bitcoin address
        ✓ should reject address with wrong prefix
        ✓ should reject invalid format
      Utility Error Cases
        ✓ should reject empty address
        ✓ should reject unsupported address format
        ✓ should reject address with invalid length

  AccountControl mintTBTC Functionality
    mintTBTC return value
✓ Authorized 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 in AccountControl
✓ Authorized 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 in AccountControl
✓ Authorized 0x90F79bf6EB2c4f870365E785982E1f101E93b906 in AccountControl
✓ Authorized 0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65 in AccountControl
✓ Authorized 0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc in AccountControl
✓ Authorized 0x976EA74026E726554dB657fA54763abd0C3a0aa9 in AccountControl
✓ Authorized 0x14dC79964da2C08b23698B3D3cc7Ca32193d9955 in AccountControl
✓ Authorized 0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f in AccountControl
✓ Authorized 0xa0Ee7A142d267C1f36714E4a8F75612F20a79720 in AccountControl
      ✓ should return satoshi amount after successful mint
✓ Authorized 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 in AccountControl
✓ Authorized 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 in AccountControl
✓ Authorized 0x90F79bf6EB2c4f870365E785982E1f101E93b906 in AccountControl
✓ Authorized 0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65 in AccountControl
✓ Authorized 0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc in AccountControl
✓ Authorized 0x976EA74026E726554dB657fA54763abd0C3a0aa9 in AccountControl
✓ Authorized 0x14dC79964da2C08b23698B3D3cc7Ca32193d9955 in AccountControl
✓ Authorized 0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f in AccountControl
✓ Authorized 0xa0Ee7A142d267C1f36714E4a8F75612F20a79720 in AccountControl
      ✓ should correctly convert and mint for various tBTC amounts
✓ Authorized 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 in AccountControl
✓ Authorized 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 in AccountControl
✓ Authorized 0x90F79bf6EB2c4f870365E785982E1f101E93b906 in AccountControl
✓ Authorized 0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65 in AccountControl
✓ Authorized 0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc in AccountControl
✓ Authorized 0x976EA74026E726554dB657fA54763abd0C3a0aa9 in AccountControl
✓ Authorized 0x14dC79964da2C08b23698B3D3cc7Ca32193d9955 in AccountControl
✓ Authorized 0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f in AccountControl
✓ Authorized 0xa0Ee7A142d267C1f36714E4a8F75612F20a79720 in AccountControl
      ✓ should properly update minted amounts using satoshi amount
✓ Authorized 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 in AccountControl
✓ Authorized 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 in AccountControl
✓ Authorized 0x90F79bf6EB2c4f870365E785982E1f101E93b906 in AccountControl
✓ Authorized 0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65 in AccountControl
✓ Authorized 0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc in AccountControl
✓ Authorized 0x976EA74026E726554dB657fA54763abd0C3a0aa9 in AccountControl
✓ Authorized 0x14dC79964da2C08b23698B3D3cc7Ca32193d9955 in AccountControl
✓ Authorized 0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f in AccountControl
✓ Authorized 0xa0Ee7A142d267C1f36714E4a8F75612F20a79720 in AccountControl
      ✓ should emit MintExecuted event with satoshi amount
✓ Authorized 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 in AccountControl
✓ Authorized 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 in AccountControl
✓ Authorized 0x90F79bf6EB2c4f870365E785982E1f101E93b906 in AccountControl
✓ Authorized 0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65 in AccountControl
✓ Authorized 0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc in AccountControl
✓ Authorized 0x976EA74026E726554dB657fA54763abd0C3a0aa9 in AccountControl
✓ Authorized 0x14dC79964da2C08b23698B3D3cc7Ca32193d9955 in AccountControl
✓ Authorized 0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f in AccountControl
✓ Authorized 0xa0Ee7A142d267C1f36714E4a8F75612F20a79720 in AccountControl
      ✓ should enforce minimum mint amount
✓ Authorized 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 in AccountControl
✓ Authorized 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 in AccountControl
✓ Authorized 0x90F79bf6EB2c4f870365E785982E1f101E93b906 in AccountControl
✓ Authorized 0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65 in AccountControl
✓ Authorized 0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc in AccountControl
✓ Authorized 0x976EA74026E726554dB657fA54763abd0C3a0aa9 in AccountControl
✓ Authorized 0x14dC79964da2C08b23698B3D3cc7Ca32193d9955 in AccountControl
✓ Authorized 0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f in AccountControl
✓ Authorized 0xa0Ee7A142d267C1f36714E4a8F75612F20a79720 in AccountControl
      ✓ should enforce maximum single mint
✓ Authorized 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 in AccountControl
✓ Authorized 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 in AccountControl
✓ Authorized 0x90F79bf6EB2c4f870365E785982E1f101E93b906 in AccountControl
✓ Authorized 0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65 in AccountControl
✓ Authorized 0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc in AccountControl
✓ Authorized 0x976EA74026E726554dB657fA54763abd0C3a0aa9 in AccountControl
✓ Authorized 0x14dC79964da2C08b23698B3D3cc7Ca32193d9955 in AccountControl
✓ Authorized 0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f in AccountControl
✓ Authorized 0xa0Ee7A142d267C1f36714E4a8F75612F20a79720 in AccountControl
      ✓ should check backing using satoshi amounts
✓ Authorized 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 in AccountControl
✓ Authorized 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 in AccountControl
✓ Authorized 0x90F79bf6EB2c4f870365E785982E1f101E93b906 in AccountControl
✓ Authorized 0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65 in AccountControl
✓ Authorized 0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc in AccountControl
✓ Authorized 0x976EA74026E726554dB657fA54763abd0C3a0aa9 in AccountControl
✓ Authorized 0x14dC79964da2C08b23698B3D3cc7Ca32193d9955 in AccountControl
✓ Authorized 0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f in AccountControl
✓ Authorized 0xa0Ee7A142d267C1f36714E4a8F75612F20a79720 in AccountControl
      ✓ should reject amounts with precision loss
    mintTBTC integration with QCMinter
✓ Authorized 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 in AccountControl
✓ Authorized 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 in AccountControl
✓ Authorized 0x90F79bf6EB2c4f870365E785982E1f101E93b906 in AccountControl
✓ Authorized 0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65 in AccountControl
✓ Authorized 0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc in AccountControl
✓ Authorized 0x976EA74026E726554dB657fA54763abd0C3a0aa9 in AccountControl
✓ Authorized 0x14dC79964da2C08b23698B3D3cc7Ca32193d9955 in AccountControl
✓ Authorized 0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f in AccountControl
✓ Authorized 0xa0Ee7A142d267C1f36714E4a8F75612F20a79720 in AccountControl
      ✓ should work correctly with QCMinter patterns

  AccountControl - Role Management
    Role Constants
      ✓ should have correct role identifiers
    RESERVE_ROLE Management
      ✓ should allow owner to grant RESERVE_ROLE
      ✓ should allow owner to revoke RESERVE_ROLE
      ✓ should prevent non-owner from granting RESERVE_ROLE
      ✓ should allow RESERVE_ROLE holder to authorize reserves
      ✓ should allow RESERVE_ROLE holder to set minting caps
    ORACLE_ROLE Management
      ✓ should allow owner to grant ORACLE_ROLE
      ✓ should allow owner to revoke ORACLE_ROLE
      ✓ should allow ORACLE_ROLE holder to set backing
      ✓ should prevent non-ORACLE_ROLE holder from setting backing
    REDEEMER_ROLE Management
      ✓ should allow owner to grant REDEEMER_ROLE
      ✓ should allow owner to revoke REDEEMER_ROLE

      4) should allow REDEEMER_ROLE holder to notify redemptions
    Role Interactions
      ✓ should allow multiple roles on same address
      ✓ should maintain role separation
    Emergency Council
      ✓ should allow emergency council to pause reserves
      ✓ should not allow emergency council to unpause reserves

  AccountControl
    Core Functionality
      Optimized totalMinted calculation 
        ✓ should return zero initially
        ✓ should track total minted amount efficiently
      Reserve deauthorization 
        ✓ should deauthorize reserve
        ✓ should revert when deauthorizing non-existent reserve
        ✓ should emit ReserveDeauthorized event
        ✓ should revert when deauthorizing reserve with outstanding balance
        ✓ should clear backing when deauthorizing clean reserve
      redeem function 
        ✓ should decrease minted amount on redemption
        ✓ should emit RedemptionProcessed event
        ✓ should revert when redeeming more than minted
      Unit consistency 
        ✓ should use correct satoshi constants
      System Pause Enforcement [validation]

        5) should block all minting when system is paused
        ✓ should allow emergency council to pause system
        ✓ should only allow owner to unpause system
        ✓ should block redemptions when system is paused
      Re-authorization 
        ✓ should allow re-authorization after deauthorization
      Input Validation [validation]
        ✓ should revert mint with amount below MIN_MINT_AMOUNT
        ✓ should revert mint with amount above MAX_SINGLE_MINT
        ✓ should accept valid single mint amounts
      Authorization Validation [validation]
        ✓ should prevent unauthorized reserves from minting

        6) should prevent paused reserves from minting
        ✓ should prevent unauthorized addresses from updating backing
    Feature Tests
      Reserve Cap Reduction Safety
        ✓ should prevent reducing cap below current minted amount
        ✓ should allow reducing cap to exactly current minted amount
        ✓ should allow increasing cap above current minted amount
      setMintingCap Validation
        ✓ should revert when setting cap for unauthorized reserve
      Authorization Race Condition Protection
        ✓ should prevent double authorization
        ✓ should prevent deauthorizing non-existent reserve
        ✓ should prevent address reuse across different reserve types
      Storage Layout Compatibility
        ✓ should maintain upgrade compatibility
    Workflow Tests
      Direct Integration Testing
        ✓ should support the complete mint workflow
        ✓ should support the complete redemption workflow
        ✓ should support backing updates affecting available mint capacity

        7) should handle multiple QCs with independent accounting
        ✓ should enforce invariants across mint/redeem cycles
        ✓ should handle reserve lifecycle properly
        ✓ should provide accurate reserve statistics

        8) should handle emergency scenarios correctly

  BitcoinAddressUtils Internal Functions
    Base58 Decoding
      Valid Base58 Decoding
        ✓ should decode valid base58 address correctly
        ✓ should handle leading zeros correctly
        ✓ should decode P2SH addresses correctly
      Invalid Base58 Handling
        ✓ should reject base58 with invalid characters
        ✓ should handle empty input
      Base58 Character Conversion
        ✓ should convert valid base58 characters correctly
        ✓ should reject invalid base58 characters
    Bech32 Operations
      Bech32 Address Detection
        ✓ should detect valid bech32 addresses
        ✓ should reject mixed case bech32 addresses
        ✓ should reject addresses with wrong prefix
        ✓ should reject addresses without proper separator
      Mixed Case Detection
        ✓ should detect mixed case in addresses
        ✓ should pass for all lowercase
        ✓ should pass for all uppercase
        ✓ should pass for numbers and special chars
      Bech32 Prefix Validation
        ✓ should validate mainnet prefixes
        ✓ should validate testnet prefixes
        ✓ should reject invalid prefixes
      Bech32 Character Conversion
        ✓ should convert valid bech32 characters correctly
        ✓ should reject invalid bech32 characters
      Bech32 Polymod Function
        ✓ should compute polymod correctly for known values
        ✓ should handle large values correctly
    Bit Conversion
      5-bit to 8-bit Conversion
        ✓ should convert 5-bit groups to 8-bit correctly
        ✓ should handle padding correctly
        ✓ should handle empty input
      8-bit to 5-bit Conversion
        ✓ should convert 8-bit data to 5-bit groups
      Boundary Cases
        ✓ should handle start/end indices correctly
        ✓ should handle single element conversion
    Address Decoding Components
      Base58 Address Decoding
        ✓ should decode P2PKH address correctly
        ✓ should decode P2SH address correctly
        ✓ should reject invalid base58 address
      Bech32 Address Decoding
        ✓ should decode P2WPKH address correctly
        ✓ should decode P2WSH address correctly
        ✓ should reject invalid bech32 address
    Checksum Functions
      Bech32 Checksum Calculation
        ✓ should calculate checksum for derivation correctly
        ✓ should produce different checksums for different data
        ✓ should produce different checksums for different HRP

  QCData - Bitcoin Address Validation
    Valid Bitcoin Address Validation
      P2PKH Addresses (1...)
transferred 4500000000 T to the VendingMachine for NU
Warning: Potentially unsafe deployment of WalletRegistry

    You are using the `unsafeAllow.external-library-linking` flag to include external libraries.
    Make sure you have manually checked that the linked libraries are upgrade safe.

Warning: Potentially unsafe deployment of BridgeStub

    You are using the `unsafeAllow.external-library-linking` flag to include external libraries.
    Make sure you have manually checked that the linked libraries are upgrade safe.


        9) "before each" hook for "should accept valid P2PKH address #1: 1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa"

  QCData - Centralized Error Handling
    QC Registration Errors
transferred 4500000000 T to the VendingMachine for NU
Warning: Potentially unsafe deployment of WalletRegistry

    You are using the `unsafeAllow.external-library-linking` flag to include external libraries.
    Make sure you have manually checked that the linked libraries are upgrade safe.

Warning: Potentially unsafe deployment of BridgeStub

    You are using the `unsafeAllow.external-library-linking` flag to include external libraries.
    Make sure you have manually checked that the linked libraries are upgrade safe.


      10) "before each" hook for "should throw InvalidQCAddress for zero address"

  QCData - Oracle Integration
    1. Basic Oracle Data Management
      1.1 Oracle Data Initialization
transferred 4500000000 T to the VendingMachine for NU
Warning: Potentially unsafe deployment of WalletRegistry

    You are using the `unsafeAllow.external-library-linking` flag to include external libraries.
    Make sure you have manually checked that the linked libraries are upgrade safe.

Warning: Potentially unsafe deployment of BridgeStub

    You are using the `unsafeAllow.external-library-linking` flag to include external libraries.
    Make sure you have manually checked that the linked libraries are upgrade safe.


        11) "before each" hook for "should initialize oracle data with default values for new QCs"

  QCData - PauseLevel Integration
    QC Registration with Default Pause Settings
transferred 4500000000 T to the VendingMachine for NU
Warning: Potentially unsafe deployment of WalletRegistry

    You are using the `unsafeAllow.external-library-linking` flag to include external libraries.
    Make sure you have manually checked that the linked libraries are upgrade safe.

Warning: Potentially unsafe deployment of BridgeStub

    You are using the `unsafeAllow.external-library-linking` flag to include external libraries.
    Make sure you have manually checked that the linked libraries are upgrade safe.


      12) "before each" hook for "should initialize QC with MintingOnly pause level"

  QCData - Two-Step Wallet Lifecycle
    Wallet Registration (Step 1)
transferred 4500000000 T to the VendingMachine for NU
Warning: Potentially unsafe deployment of WalletRegistry

    You are using the `unsafeAllow.external-library-linking` flag to include external libraries.
    Make sure you have manually checked that the linked libraries are upgrade safe.

Warning: Potentially unsafe deployment of BridgeStub

    You are using the `unsafeAllow.external-library-linking` flag to include external libraries.
    Make sure you have manually checked that the linked libraries are upgrade safe.


      13) "before each" hook for "should register wallet as Inactive status"

  QCData
    Deployment
      ✓ should grant deployer default admin role
      ✓ should have correct role constants
    QC Registration
      when called by QC manager
        ✓ should register QC successfully
        ✓ should revert when QC already registered
        ✓ should revert with zero address
        ✓ should revert with zero minting capacity
      when called by non-manager
        ✓ should revert
    QC Status Management
      when called by QC manager
        ✓ should update QC status successfully
        ✓ should handle all valid status values
        ✓ should revert when QC not registered
        ✓ should update status to UnderReview
      when called by non-manager
        ✓ should revert
    Minted Amount Management
      when called by QC manager
        ✓ should update minted amount successfully
        ✓ should handle zero amount
        ✓ should handle large amounts
        ✓ should revert when QC not registered
      when called by non-manager
        ✓ should revert
    Wallet Registration
      when called by QC manager
        ✓ should register wallet successfully
        ✓ should register multiple wallets for same QC
        ✓ should revert when wallet already registered
        ✓ should revert when QC not registered

        14) should revert with empty wallet address
        ✓ should revert when maximum wallets per QC exceeded
        ✓ should return correct wallet capacity information
      when called by non-manager
        ✓ should revert
    Wallet Deregistration
      request deregistration
        ✓ should request deregistration successfully
        ✓ should revert when wallet not registered
        ✓ should revert when wallet not active
      finalize deregistration
        ✓ should finalize deregistration successfully
        ✓ should revert when wallet not registered
        ✓ should revert when wallet not pending deregistration
    View Functions
      isQCRegistered
        ✓ should return true for registered QC
        ✓ should return false for unregistered QC
      getQCStatus
        ✓ should return correct status
        ✓ should revert for unregistered QC
      getQCMintedAmount
        ✓ should return correct minted amount
        ✓ should return 0 for unregistered QC
      getQCWallets
        ✓ should return all registered wallets
        ✓ should return empty array for unregistered QC
        ✓ should update when wallets are deregistered
      getWalletOwner
        ✓ should return correct owner
        ✓ should return zero address for unregistered wallet
        ✓ should preserve owner address for deregistered wallet
      getWalletStatus
        ✓ should return correct status
        ✓ should return 0 for unregistered wallet
        ✓ should return correct status after deregistration
    Edge Cases
      wallet status transitions
        ✓ should handle complete deregistration cycle
      multiple QCs with same wallet address
        ✓ should prevent registering same wallet to different QCs
      boundary conditions
        ✓ should handle maximum length wallet addresses
        ✓ should handle maximum minted amounts
    New Utility Functions
      isWalletActive
        ✓ should return true for active wallet
        ✓ should return false for pending deregistration wallet
        ✓ should return false for deregistered wallet
        ✓ should return false for unregistered wallet
      isWalletDeregistered
        ✓ should return false for active wallet
        ✓ should return false for pending deregistration wallet
        ✓ should return true for deregistered wallet
        ✓ should return false for unregistered wallet
      canActivateWallet
        ✓ should return false for active wallet
        ✓ should return false for pending deregistration wallet
        ✓ should return false for deregistered wallet
        ✓ should return false for unregistered wallet
    Enhanced State Machine Tests
      comprehensive state transitions
        ✓ should handle full lifecycle: Active -> PendingDeRegistration -> Deregistered
        ✓ should prevent reactivation of deregistered wallet
        ✓ should prevent double deregistration request
        ✓ should prevent direct finalization without request
      audit trail preservation
        ✓ should maintain complete audit trail after deregistration
      state machine edge cases
        ✓ should handle rapid state transitions correctly
        ✓ should maintain state consistency under concurrent operations
    Role Management
      grantQCManagerRole
        ✓ should grant QC_MANAGER_ROLE to valid address
        ✓ should revert with zero address
        ✓ should allow multiple managers
        ✓ should only be callable by admin
      revokeQCManagerRole
        ✓ should revoke QC_MANAGER_ROLE from address
        ✓ should succeed with zero address (no validation)
        ✓ should succeed when role not granted (no validation)
        ✓ should only be callable by admin
    Minting Capacity Management
      updateMaxMintingCapacity
        ✓ should update max minting capacity and emit event
        ✓ should allow updating capacity multiple times
        ✓ should revert with zero capacity
        ✓ should revert if QC not registered
        ✓ should only be callable by QC manager
      getMaxMintingCapacity
        ✓ should return correct capacity for registered QC
        ✓ should return initial capacity set during registration
        ✓ should return zero for unregistered QC
        ✓ should be a view function with no gas cost

  QCManager - Batch Operation Safety
    Circuit Breaker Constants

      15) "before each" hook for "should have correct circuit breaker thresholds"

  QCManagerLib - Financial Function Integration Tests
    Minting Capacity Validation Integration
      validateMintingCapacityUpdate via increaseMintingCapacity

        16) "before each" hook for "should successfully validate and update valid capacity increases"

  QCManagerLib - Bitcoin Address Validation (Direct Tests)
    isValidBitcoinAddress Function
      Valid Bitcoin Address Formats
        ✓ should accept valid P2PKH addresses (starts with '1')
        ✓ should accept valid P2SH addresses (starts with '3')
        ✓ should accept valid Bech32 addresses (starts with 'bc1')
      Invalid Bitcoin Address Formats
        ✓ should reject empty string
        ✓ should reject addresses that are too short
        ✓ should reject addresses that are too long
        ✓ should reject invalid prefixes
        ✓ should reject invalid Bech32 variations
        ✓ should reject Ethereum addresses
        ✓ should reject random strings and malformed addresses
        ✓ should note that basic validation may pass some invalid formats
      Edge Cases and Special Characters

        17) should handle unicode characters
        ✓ should note that basic validation may pass some unicode cases

        18) should handle whitespace and control characters
        ✓ should handle boundary lengths precisely

        19) should handle case sensitivity properly
        ✓ should handle repeated characters
      Performance and Gas Testing
        ✓ should handle validation efficiently
        ✓ should handle maximum length addresses without issues
      Real-world Bitcoin Addresses
        ✓ should validate known real Bitcoin addresses
        ✓ should reject known invalid patterns

  QCManagerLib - Comprehensive Error Condition Testing
    Registration Error Conditions
      Invalid QC Address Errors

        20) "before each" hook for "should revert with InvalidQCAddress for zero address registration"

  QCManagerLib - Wallet Registration Validation (External Functions)
    validateWalletRegistrationFull Function
      Successful Validation Cases

        21) should validate successfully with all valid parameters

        22) should validate with different valid Bitcoin address formats
      Invalid Bitcoin Address Cases

        23) should revert with InvalidWalletAddress for empty address

        24) should revert with InvalidWalletAddress for malformed address

        25) should revert with InvalidWalletAddress for Ethereum address
      QC Registration and Status Validation

        26) should revert with QCNotRegistered for unregistered QC

        27) should revert with QCNotActive for inactive QC

        28) should revert with QCNotActive for revoked QC
      Signature Validation

        29) should revert with SignatureVerificationFailed for invalid signature

        30) should revert with SignatureVerificationFailed for wrong public key length
      Edge Cases

        31) should handle different challenge values

        32) should handle maximum length Bitcoin addresses
    validateDirectWalletRegistration Function
      Successful Validation Cases

        33) should validate successfully and return challenge

        34) should generate deterministic challenges

        35) should generate different challenges for different inputs

        36) should handle different Bitcoin address formats
      QC Registration and Status Validation

        37) should revert with QCNotRegistered for unregistered QC

        38) should revert with QCNotActive for inactive QC
      Bitcoin Address Validation

        39) should revert with InvalidWalletAddress for empty address

        40) should revert with InvalidWalletAddress for invalid format
      Signature and Public Key Validation

        41) should revert with SignatureVerificationFailed for invalid signature

        42) should revert with SignatureVerificationFailed for wrong pubkey length
      Challenge Generation Logic

        43) should generate challenges with expected format

        44) should handle edge case nonce values
    Cross-Function Consistency

      45) should have consistent validation logic between both functions

      46) should consistently validate QC status

  QCManagerLib - Consolidated Tests
    Core Library Functions
      Library Error Validation

        47) "before each" hook for "should revert with InvalidQCAddress when registering zero address"

  QCManager - Oracle Fallback System
    Graceful Degradation Configuration

      48) "before each" hook for "should enable graceful degradation"

  QCManager
    Deployment

      49) "before each" hook for "should set correct dependencies"

  QCMinter
    Deployment
      ✓ should set correct qcData
      ✓ should set correct systemState
      ✓ should set correct qcManager
      ✓ should set correct accountControl
      ✓ should grant DEFAULT_ADMIN_ROLE to deployer
      ✓ should grant MINTER_ROLE to deployer
      when deployed with invalid addresses
        ✓ should revert with zero qcData address
        ✓ should revert with zero systemState address
        ✓ should revert with zero qcManager address
        ✓ should revert with zero accountControl address
    requestQCMint
      when called with valid parameters
        ✓ should check system state
        ✓ should verify QC status
        ✓ should atomically consume minting capacity
        ✓ should call AccountControl to mint TBTC
        ✓ should emit QCMintRequested event
        ✓ should emit MintCompleted event
      when called with invalid parameters
        ✓ should revert with zero QC address
        ✓ should revert with zero amount
        ✓ should revert with zero user address
      when minting is paused
        ✓ should revert
      when QC is emergency paused
        ✓ should revert
      when QC is not active
        ✓ should revert
      when amount exceeds capacity
